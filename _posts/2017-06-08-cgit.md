---
layout: post
title: Cgit 2017 and Apache2 -> nice highlighting by Pygments
date: 2017-06-08 16:20
update_date: 
cover: /images/cover-cgit-apache2.jpg
width: 2592
height: 4608
tags:
- git
- cgit
- code
- httpd
- apache2
- pygments
- debian
description: 2017 new Cgit and Apache2. This is nothing special. But I believe plenty of people really stuck apache2 alias with cgit and others. 
location: local
locale:

---

## Requirement

`apt install cgit apache2 python3-pygments`

## Cgit

Configure /etc/cgitrc

```shell
source-filter=/usr/lib/cgit/filters/syntax-highlighting.py
css=/cgit-css/cgit.css
logo=/cgit-css/git-logo.png
favicon=/cgit-css/git-favicon.png
scan-path=/160G/git/
enable-git-config=1
repo.group=Lab
```

**If source-filter is not top, it does not work.**  
The path ex. css=/cgit-css, that link to Apache2 alias config.

## Apache2

Load cgi

```shell
cd /etc/apache2/mod-enabled
sudo ln -s ../mod-available/cgi.load
```

Configure /etc/apache2/sites-available/cgit.conf

```apache
ServerName git.awas.lab
ScriptAlias / "/usr/lib/cgit/cgit.cgi/"
<Directory "/160G/git/">
  AllowOverride None
  Options None
  Require all granted
</Directory>
<Directory "/usr/lib/cgit/">
  AllowOverride None
  Options ExecCGI FollowSymlinks
  Require all granted
</Directory>
```

Then, 

```shell
cd /etc/apache2/site-enabled
sudo ln -s ../site-available/cgit.conf .
```

Configure /etc/apache2/mods-available/alias.conf

```apache
<IfModule alias_module>
        Alias /cgit-css "/usr/share/cgit"

        <Directory "/usr/share/cgit">
                Options FollowSymlinks
                AllowOverride None
                Require all granted
        </Directory>
</IfModule>
```

This Alias path made me stuck. **It should not add end slash**.

## Pygments

Configure /usr/lib/cgit/filters/syntax-highlighting.py

```python
...
filename = sys.argv[1]
formatter = HtmlFormatter(style='manni')

try:
        lexer = guess_lexer_for_filename(filename, data)
...
```

Able to change style by (style='foo').


