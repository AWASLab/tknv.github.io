---
layout: post
title: All to mp3 format
date: '2012-02-02T01:05:00.002+09:00'
author: tknv
comments: true
category:
- format
- converter
- ogg
- wav
- mp3
- music
- mp4
- lame
- aac
modified_time: '2012-02-02T01:05:00.290+09:00'
blogger_id: tag:blogger.com,1999:blog-2736766923155041598.post-821474244108157215
blogger_orig_url: http://yet-another-problem.blogspot.com/2012/02/all-to-mp3-format.html
---

<blockquote>いろんなフォーマットからmp3へ</blockquote><b>Howto:convert aac/mp4 to wav/mp3/ogg on Linux</b><br />m4a is the file extension for the proprietary audio format mostly used by that iTunes thingy. A conversion to more player friendly (usb mp3player for example) formats like mp3 or ogg only works, if the aac's aren't DRM protected. For the conversion you need the following tools installed:<br /><br /><ul><li>mplayer (with faad2 support compiled in!)</li><li>faad2</li><li>for mp3: lame</li><li>for ogg: oggenc (vorbis-tools)</li></ul><br /><b>aac/m4a to wav</b><br />In case you only want to convert a single file:<br /><code>mplayer -ao pcm inputfile.m4a -ao pcm:file="outfile.wav"</code><br />or - if you want to use faad:<br /><code>faad inputfile.aac</code><br />If you want to convert all files in a directory, you can use this little script:<br /><pre style="background-color: #232323; color: #e6e0db; font-size: 12px; line-height: 14px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left;">#!/bin/bash<br /># <br /># m4a2wav<br /># <br />for i in *.m4a; do<br />   # out=$(echo $i | sed -e 's/.m4a//g')<br />    mplayer -ao pcm "$i" -ao pcm:file="${i%.m4a}.wav"<br />done</pre>This also seems to work for converting all aac/m4a files in a directory (please note that this will also search sub-directories):<br /><code>find -name '*.m4a' -exec faad '{}' ';'</code><br />Note: the inputfiles shouldn't contain spaces (maybe we should sed those away too in the script? :))<br /><b>wav to mp3</b><br />Now we can convert the wav's to mp3 or ogg or whatever we like. For example to convert to mp3 we can use this second script:<br /><pre style="background-color: #232323; color: #e6e0db; font-size: 12px; line-height: 14px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left;">#!/bin/bash <br /># <br /># wav2mp3<br /># <br />for i in *.wav; do<br />    #out=$(ls $i | sed -e 's/.wav//g')<br />    #out=$(echo $i | sed -e 's/.wav$//')<br />    #lame -h -b 192 "$i" "$out.mp3"<br />    lame -h -b 192 "$i" "${i%.wav}.mp3"<br />done</pre>That's it ;)<br /><b>mp3 to wav</b><br />Now we can convert mp3 to wav.<br /><code>mpg123 -w output.wav input.mp3</code><br /><b>aac2ogg script</b><br />There is also a python script available at <a href="http://www.samsix.com/scripts/aac2ogg">http://www.samsix.com/scripts/aac2ogg</a> for converting to ogg vorbis with tags intact. It will also automatically determine the bitrate of the original file and use an appropriate quality setting to match. This is based on the perl script<a href="http://zarb.org/~zerodogg/scripts/aac2ogg">http://zarb.org/~zerodogg/scripts/aac2ogg</a>.<br /><b>aac2mp3 script</b><br />Ok here is a little script that does all that in one step. THX to Nico for a good working one, and BIG thanks to Reto L. for a new improved version that comes with switches for program paths, bitrate and more useful options! see 'aac2mp3 -h' for a help text ;)<br /><br /><pre style="background-color: #232323; color: #e6e0db; font-size: 12px; line-height: 14px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left;">#!/bin/bash<br /><br />#<br /># $Id: aac2mp3,v 1.2 2005/08/22 15:32:34 rali Exp $<br />#<br /><br />#<br /># Convert one or more AAC/M4A files to MP3.  Based on a script example<br /># I found at: http://gimpel.gi.funpic.de/Howtos/convert_aac/index.html<br />#<br /><br />ME=`basename ${0}`<br /><br />AAC2WAV="/usr/bin/mplayer"<br />WAV2MP3="/usr/bin/lame"<br /><br />EXT="m4a"<br />BITRATE="192"<br /><br />do_usage() {            # explanatory text<br />  echo "usage: ${ME} [-b nnn] [-e ext] [-f] [-c] [-r] [-v] [-h] [file list]"<br />  echo "       Convert music from AAC format to MP3"<br />  echo "  -l /path/app  Specify the location of lame(1)"<br />  echo "  -m /path/app  Specify the location of mplayer(1)"<br />  echo "  -b nnn        bitrate for mp3 encoder to use"<br />  echo "  -e ext        Use .ext rather than .m4a extension"<br />  echo "  -f            Force overwrite of existing file"<br />  echo "  -c            Delete original AAC|M4A file(s)"<br />  echo "  -s            Keep intermediate .wav file(s)"<br />  echo "  -v            Verbose output"<br />  echo "  -h            This information"<br />  exit 0<br />  }<br /><br />do_error() {<br />  echo "$*"<br />  exit 1<br />  }<br /><br />file_overwrite_check() {<br />  if [ "$FORCE"&nbsp;!= "yes" ]<br />  then<br />    test -f "${1}" &amp;&amp; do_error "${1} already exists."<br />  else<br />    test -f "${1}" &amp;&amp; echo "  ${1} is being overwritten."<br />  fi<br />  }<br /><br />create_wav() {  # use mplayer(1) to convert from AAC to WAV<br />  file_overwrite_check "${2}"<br /><br />  test $VERBOSE &amp;&amp; echo -n "Creating intermediate WAV file"<br /><br />  ${AAC2WAV} -really-quiet -ao pcm "${1}" -ao pcm:file="${2}"<br />  if [ $? -ne 0 ]<br />  then<br />    echo ""<br />    echo "Conversion to WAV (${AAC2WAV}) failed."<br />    do_cleanup<br />    do_error "Exiting"<br />  fi<br /><br />  test $VERBOSE &amp;&amp; echo ".  OK"<br />  }<br /><br />create_mp3() {  # use lame(1) to convert from WAV to MP3<br />  file_overwrite_check "${2}"<br /><br />  test $VERBOSE &amp;&amp; echo -n "Creating output MP3 file"<br /><br />  ${WAV2MP3} -h -b ${BITRATE} -S "${1}" "${2}"<br />  if [ $? -ne 0 ]<br />  then<br />    echo ""<br />    echo "Conversion to MP3 (${WAV2MP3}) failed."<br />    do_cleanup<br />    do_error "Exiting"<br />  fi<br /><br />  test $VERBOSE &amp;&amp; echo ".  OK"<br />  }<br /><br />do_cleanup() {  # Delete intermediate and (optionally) original file(s)<br />  test $VERBOSE &amp;&amp; echo -n "Deleting intermediate file"<br />  test ${SAVEWAV} || rm -f "${2}"<br />  test ${RMM4A}   &amp;&amp; rm -f "${1}"<br />  test $VERBOSE &amp;&amp; echo ".  OK"<br />  }<br /><br />do_set_bitrate() {<br />  test $VERBOSE &amp;&amp; echo -n "Setting output bitrate to: $1 kbps"<br />  BITRATE=$1<br />  test $VERBOSE &amp;&amp; echo ".  OK"<br />  }<br /><br />GETOPT=`getopt -o l:m:b:e:cfhrv -n ${ME} -- "$@"`<br />if [ $? -ne 0 ]<br />then<br />  do_usage<br />fi<br /><br />eval set -- "$GETOPT"<br /><br />while true<br />do<br />  case "$1" in<br />    -l) LAME=$2&nbsp;; shift&nbsp;; shift&nbsp;;;<br />    -m) MPLAYER=$2&nbsp;; shift&nbsp;; shift&nbsp;;;<br />    -b) do_set_bitrate $2&nbsp;; shift&nbsp;; shift&nbsp;;;<br />    -e) EXT=$2&nbsp;; shift&nbsp;; shift&nbsp;;;<br />    -f) FORCE="yes"&nbsp;; shift&nbsp;;;<br />    -c) RMM4A="yes"&nbsp;; shift&nbsp;;;<br />    -s) SAVEWAV="yes"&nbsp;; shift&nbsp;;;<br />    -v) VERBOSE="yes"&nbsp;; shift&nbsp;;;<br />    -h) do_usage&nbsp;;;<br />    --) shift&nbsp;; break&nbsp;;;<br />     *)  do_usage&nbsp;;;<br />  esac<br />done<br /><br />test -f $LAME    || do_error "$LAME not found. Use \"-l\" switch."<br />test -f $MPLAYER || do_error "$MPLAYER not found. Use \"-m\" switch."<br /><br />if [ $# -eq 0 ]<br />then                    # Convert all files in current directory<br />  for IFILE in *.${EXT}<br />  do<br />    if [ "${IFILE}" == "*.${EXT}" ]<br />    then<br />      do_error "No files with extension ${EXT} in this directory."<br />    fi<br /><br />    OUT=`echo "${IFILE}" | sed -e "s/\.${EXT}//g"`<br /><br />    create_wav "${IFILE}"   "${OUT}.wav"<br />    create_mp3 "${OUT}.wav" "${OUT}.mp3"<br />    do_cleanup "${IFILE}"   "${OUT}.wav"<br /><br />  done<br />else                    # Convert listed files<br />  for IFILE in "$*"<br />  do<br />    test -f "${IFILE}" || do_error "${IFILE} not found."         <br /><br />    OUT=`echo "${IFILE}" | sed -e "s/\.${EXT}//g"`         <br /><br />    create_wav "${IFILE}" "${OUT}.wav"         <br />    create_mp3 "${OUT}.wav" "${OUT}.mp3"         <br />    do_cleanup "${IFILE}" "${OUT}.wav"         <br />  done         <br />fi         <br />exit 0</pre><b>aac2mp3 - faster</b><br />This script, based on the above, is faster because it uses ffmpeg for conversion. ffmpeg converts directly to mp3, and does not create an intermediate wav file. You will have to compile ffmpeg with LAME enabled; check ffmpeg's ./configure --help to enable proper libs.<br /><br /><pre style="background-color: #232323; color: #e6e0db; font-size: 12px; line-height: 14px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left;">#!/bin/bash<br />#<br /># $Id: aac2mp3,v 1.2  03/30/2008 10:00 Daniel Tavares (dantavares@gmail.com) - <br /># Based on Script -  rali Exp $<br />#<br />#<br /># Convert one or more AAC/M4A files to MP3.  Based on a script example<br /># I found at: http://gimpel.gi.funpic.de/Howtos/convert_aac/index.html<br />#<br />ME=`basename ${0}`<br />FFMPEG="/usr/bin/ffmpeg"<br />EXT="mp4"<br />BITRATE="128"<br />do_usage() {            # explanatory text<br /> echo "usage: ${ME} [-b nnn] [-e ext] [-f] [-c] [-r] [-v] [-h] [file list]"<br /> echo "       Convert music from AAC format to MP3"<br /> echo "  -m /path/app  Specify the location of ffmpeg(1)"<br /> echo "  -b nnn        bitrate for mp3 encoder to use"<br /> echo "  -e ext        Use .ext rather than .m4a extension"<br /> echo "  -f            Force overwrite of existing file"<br /> echo "  -c            Delete original AAC|M4A file(s)"<br /> echo "  -v            Verbose output"<br /> echo "  -h            This information"<br /> echo ""<br /> echo "For recursive directory, use: find -name '*.${EXT}' -exec ${ME} "{}" [args] \;"<br /> exit 0<br /> }<br />do_error() {<br /> echo "$*"<br /> exit 1<br /> }<br />file_overwrite_check() {<br /> if [ "$FORCE"&nbsp;!= "yes" ]<br /> then<br />   test -f "${1}" &amp;&amp; do_error "${1} already exists."<br /> else<br />   test -f "${1}" &amp;&amp; echo "  ${1} is being overwritten."<br /> fi<br /> }<br />create_mp3() {  # use ffmpeg(1) to convert from AAC to MP3<br /> file_overwrite_check "${2}"<br /> test $VERBOSE &amp;&amp; echo -n "Converting file: ${1}"<br /> ${FFMPEG} -v 5 -y -i "${1}" -acodec libmp3lame -ac 2 -ab ${BITRATE}k "${2}";<br /> if [ $? -ne 0 ]<br /> then<br />   echo ""<br />   echo "Error!"<br />   do_cleanup<br />   do_error "Exiting"<br /> fi<br /> test $VERBOSE &amp;&amp; echo ".  OK"<br /> }<br />do_cleanup() {  # Delete intermediate and (optionally) original file(s)<br /> test ${RMM4A} &amp;&amp; rm -f "${1}"<br /> test $VERBOSE &amp;&amp; echo ".  OK"<br /> }<br />do_set_bitrate() {<br /> test $VERBOSE &amp;&amp; echo -n "Setting bitrate to: $1 kbps"<br /> BITRATE=$1<br /> test $VERBOSE &amp;&amp; echo ".  OK"<br /> }<br />GETOPT=`getopt -o l:m:b:e:cfhrv -n ${ME} -- "$@"`<br />if [ $? -ne 0 ]<br />then<br /> do_usage<br />fi<br />eval set -- "$GETOPT"<br />while true<br />do<br /> case "$1" in<br />   -m) FFMPEG=$2&nbsp;; shift&nbsp;; shift&nbsp;;;<br />   -b) do_set_bitrate $2&nbsp;; shift&nbsp;; shift&nbsp;;;<br />   -e) EXT=$2&nbsp;; shift&nbsp;; shift&nbsp;;;<br />   -f) FORCE="yes"&nbsp;; shift&nbsp;;;<br />   -c) RMM4A="yes"&nbsp;; shift&nbsp;;;<br />   -v) VERBOSE="yes"&nbsp;; shift&nbsp;;;<br />   -h) do_usage&nbsp;;;<br />   --) shift&nbsp;; break&nbsp;;;<br />    *)  do_usage&nbsp;;;<br /> esac<br />done<br />test -f $FFMPEG || do_error "$FFMPEG not found. Use \"-m\" switch."<br />if [ $# -eq 0 ]<br />then                    # Convert all files in current directory<br /> for IFILE in *.${EXT}<br /> do<br />   if [ "${IFILE}" == "*.${EXT}" ]<br />   then<br />     do_error "Not found ${EXT} in this folder."<br />   fi<br />   OUT=`echo "${IFILE}" | sed -e "s/\.${EXT}//g"`<br />   create_mp3 "${IFILE}" "${OUT}.mp3"<br />   do_cleanup "${IFILE}" <br /> done<br />else                    # Convert listed files<br /> for IFILE in "$*"<br /> do<br />   test -f "${IFILE}" || do_error "${IFILE} not found."         <br />   OUT=`echo "${IFILE}" | sed -e "s/\.${EXT}//g"`         <br />   create_mp3 "${IFILE}" "${OUT}.mp3"<br />   do_cleanup "${IFILE}"         <br /> done         <br />fi         <br />exit 0</pre><b>ogg2mp3</b><br />cf. <a href="http://forums.gentoo.org/viewtopic-t-463068-highlight-.htm">http://forums.gentoo.org/viewtopic-t-463068-highlight-.htm</a>l for my bash script<br /><b>Set the Tags on .mp3 Files After Conversion</b><br />This little script is handy to set the artist, album, and song information on all the .mp3 files in a directory, after you have converted them from some other format, or because the tags are screwed up, causing your mp3 player to sort the songs incorrectly.<br /><br /><pre style="background-color: #232323; color: #e6e0db; font-size: 12px; line-height: 14px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left;">#!/bin/bash<br /># tagmp3<br /># Tags every .mp3 in the directory with the band and<br /># album names, and creates a song title by stripping<br /># the .mp3 extension from the file name.<br /># Call like this:<br /># tagmp3 bandname albumname<br />for i in *.mp3; do<br />    SONG=`basename "$i" .mp3`<br />    id3v2 --album "$2" --artist "$1" --song "$SONG" "$i"<br />done</pre><b>Convert m4a to mp3, setting tag information</b><br />This script converts all the .m4a files in a directory to .mp3, setting the artist and album info to the values you specify on the command line, and setting the title info using the file name. Glues together several of the above scripts.<br /><br /><pre style="background-color: #232323; color: #e6e0db; font-size: 12px; line-height: 14px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left;">#!/bin/bash<br /># m4a2mp3<br /># Convert all m4a to mp3, assign tags, delete intermediary<br /># wav files<br /># Tags every .mp3 in the directory with the band and<br /># album names, and creates a song title by stripping<br /># the .mp3 extension from the file name.<br /># Call like this:<br /># m4a2mp3 bandname albumname<br />m4a2wav<br />wav2mp3<br />tagmp3 "$1" "$2"<br />rm *.wav</pre><b>aac/m4a/mp4/rm/ram/any to mp3</b><br />Using mplayer and lame :<br /><br /><pre style="background-color: #232323; color: #e6e0db; font-size: 12px; line-height: 14px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left;">#! /bin/bash<br />#<br /># Converts an Audio file to a MP3 and adds an ID3 tag.<br />#<br /># Usage: audio2mp3 infile [outfile]<br />#<br />IFS=";" title_author=(`mplayer -vc null -vo null -ao pcm:fast -ao pcm "$1" -ao pcm:file="$1.wav" 2&gt;&amp;1 | awk -F: 'BEGIN { ORS = ";" }&nbsp;; $1 ~ /name|author/ { print $2 }'`)<br />author=${title_author[0]}<br />title=${title_author[1]}<br />echo "Author: $author"<br />echo "Title: $title"<br />lame "$1".wav "$2" --tt "$title" --ta "$author"<br />rm "$1".wav</pre>Enjoy ;-)<br /><b>Suse 11.1 bash script mp4 to mp3</b><br />Using mplayer and lame :<br /><br /><pre style="background-color: #232323; color: #e6e0db; font-size: 12px; line-height: 14px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left;">#! /bin/bash<br />#<br /># Converts all MP4 files in the current directory to MP3s.<br />#<br />for f in *.MP4; do<br /> newname=`echo $f | tr ' ' '_' `<br /> mv "$f" $newname<br /> f=$newname<br /> mplayer $f -ao pcm:file=tmp.wav<br /> lame -b 128 -q 2 tmp.wav ${f/.MP4/.mp3}<br /> rm -f tmp.wav<br />done</pre><blockquote>Content is available under <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3</a>.<br />Content from <a href="http://gimpel.gi.funpic.de/wiki/index.php?title=Howto:convert_aac/mp4_to_wav/mp3/ogg_on_Linux">here</a>.</blockquote>
