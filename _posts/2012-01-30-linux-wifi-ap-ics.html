---
layout: post
title: linux wifi AP, ホテルでインターネット共有, ics
date: '2012-01-30T03:05:00.000+09:00'
author: tknv
comments: true
category:
- ad-hoc
- 11abgn
- linux
- windows
- iwl4965
- AccessPoint
modified_time: '2012-01-30T03:05:32.238+09:00'
blogger_id: tag:blogger.com,1999:blog-2736766923155041598.post-8366541833726695896
blogger_orig_url: http://yet-another-problem.blogspot.com/2012/01/linux-wifi-ap-ics.html
---

<h1>linux wifi AP, ホテルでインターネット共有, ics</h1>At a Hotel, two laptops or laptop, ipad, iphone and etc want to connect internet even one line ethernet.  <br />If you are rich like a easy to buy wifi router and also like to bring many goods, please use router. <br /><center><a href="http://www.amazon.co.jp/gp/product/1932624449/ref=as_li_tf_il?ie=UTF8&amp;tag=pdb0c-22&amp;linkCode=as2&amp;camp=247&amp;creative=1211&amp;creativeASIN=1932624449"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&amp;Format=_SL160_&amp;ASIN=1932624449&amp;MarketPlace=JP&amp;ID=AsinImage&amp;WS=1&amp;tag=pdb0c-22&amp;ServiceVersion=20070822" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.jp/e/ir?t=pdb0c-22&amp;l=as2&amp;o=9&amp;a=1932624449" style="border: none !important; margin: 0px !important;" width="1" /></center><br /><blockquote>*This access point is not Master mode, networks are <strong>ad-hoc</strong> connect. Because many wifi devices embedded in Laptop PC can not be Master mode. So impossible to use hostapd.  <br />If a wifi device embedded in Laptop able to be Master mode, it can be Access Point with hostapd. <br /><code>sudo iwconfig wlan0(depend on your wifi device) mode Master</code><br />then you will know whether able to be Access Point or not. <br />This article is tested by iwl4965 device.(iwl4965 can not be Master mode)</blockquote><h2>linux host</h2><ul><li>networks</li><a href="http://www.amazon.co.jp/gp/product/B003DQHROU/ref=as_li_tf_il?ie=UTF8&amp;tag=pdb0c-22&amp;linkCode=as2&amp;camp=247&amp;creative=1211&amp;creativeASIN=B003DQHROU"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&amp;Format=_SL160_&amp;ASIN=B003DQHROU&amp;MarketPlace=JP&amp;ID=AsinImage&amp;WS=1&amp;tag=pdb0c-22&amp;ServiceVersion=20070822" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.jp/e/ir?t=pdb0c-22&amp;l=as2&amp;o=9&amp;a=B003DQHROU" style="border: none !important; margin: 0px !important;" width="1" />  <blockquote>INTERNET--wan--HOTEL ROOM--LAN--(eth0:ethernet cable)LinuxLaptopPC(wlan0:wifi)--(wifi)ipad,--(wifi)iphone,--(wifi)android and etc.</blockquote><li>prepare</li><blockquote><code> # sudo ip link set wlan0 down </code></blockquote><li>set ad-hoc mode</li><blockquote><code> # sudo iwconfig wlan0 mode ad-hoc</code></blockquote><blockquote>If wifi driver is <strong>madwifi</strong>.</blockquote><blockquote><code> # sudo wlanconfig ath1 destroy</code>&nbsp;</blockquote><blockquote><code># sudo wlanconfig ath1 create wlandev wifi0 wlanmode adhoc </code></blockquote><li>set AP essid</li><blockquote><code> # sudo iwconfig wlan0 essid oreore </code> </blockquote><li>set WEP(tested)</li><blockquote><code> # sudo iwconfig wlan0 key 1234554321 </code>  If more secure, using<strong>WPA</strong>, create wpa-adhoc.conf&nbsp;</blockquote><blockquote><script src="https://gist.github.com/1698517.js?file=wpa-adhoc.conf"></script> start WPA.&nbsp;</blockquote><blockquote><code> # sudo wpa_supplicant -cwpa-adhoc.conf -iwlan0 -Dwext </code> </blockquote><li>set IP address</li><blockquote><code> # sudo ifconfig wlan0 192.168.0.1 </code></blockquote><li>link up</li><blockquote><code> # sudo ip link set wlan0 up </code></blockquote><li>sharing the internet connection</li><blockquote>Now the internet connection interface is eth0(if using VPN, Dialup network-ADSL and etc,using ex. ppp0).&nbsp;</blockquote><blockquote><code> # sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE </code> </blockquote><li>enabling IP forwarding</li><blockquote><code> # sudo sh -c "echo 1 &gt; /proc/sys/net/ipv4/ip_forward" </code></blockquote><li>try to hide the fact that an all packet was routed, by incrementing the TTL by one.</li><blockquote><code> # sudo iptables -t mangle -A PREROUTING -j TTL --ttl-inc 1 </code></blockquote></ul><h2>windows host</h2><blockquote>see:<a href="http://support.microsoft.com/kb/309642/en">microsoft site</a><br />I could not understand how to do it.</blockquote><h2>linux client(not tested)</h2><blockquote><code><br /># sudo ip link set wlan0 down<br /><br /># sudo iwconfig wlan0 essid oreore<br /><br /># sudo iwconfig wlan0 key 1234554321<br /><br /># sudo route add default gw 192.168.0.1<br /><br /># sudo ip addr add 192.168.0.2/24 dev wlan0<br /><br /># sudo ip link set wlan0 up<br /><br /></code></blockquote><h2>windows client</h2><blockquote><ol><li>connect essid:oreore wireless network</li><li>input password:1234554321</li><li>wireless connection property</li><li>select the Internet Protocol (TCP/IP) and click Properties</li><li>set IP to 192.168.0.2</li><li>set gateway to 192.168.0.1(ad-hoc host IP)</li><li>set DNS to 8.8.8.8 and 8.8.4.4(what ever,as you like)</li></ol></blockquote>知ってて損はない。
